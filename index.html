<script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
<!--
<div style="font-size:30em; color:LightGreen; text-align:center">
  <i class="fas fa-battery-quarter"></i>
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:se="http://svg-edit.googlecode.com" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="777" height="480" style="">
    <title>my vector image</title>
    <rect id="backgroundrect" width="100%" height="100%" x="0" y="0" fill="#FFFFFF" stroke="none"/>
    <g class="currentLayer" style="">
      <title>Layer 1</title>
      <path fill="none" stroke="#222222" stroke-opacity="1" stroke-width="2" stroke-dasharray="none" stroke-linejoin="round" stroke-linecap="butt" stroke-dashoffset="" fill-rule="nonzero" opacity="1" marker-start="" marker-mid="" marker-end="" d="M288,201 C288,168.40331491712706 354.00828729281767,142 435.5,142 C516.9917127071823,142 583,168.40331491712706 583,201 C583,233.59668508287294 516.9917127071823,260 435.5,260 C354.00828729281767,260 288,233.59668508287294 288,201 Z" id="svg_1" class=""/><rect fill="#e76767" stroke="#222222" stroke-width="2" stroke-linejoin="round" stroke-dashoffset="" fill-rule="nonzero" id="svg_4" x="349" y="173" width="26" height="9" style="color: rgb(0, 0, 0);" class="" fill-opacity="1"/><rect fill="#919191" stroke="#222222" stroke-width="2" stroke-linejoin="round" stroke-dashoffset="" fill-rule="nonzero" x="494.41437208652496" y="171.4530372619629" width="26" height="9" style="color: rgb(0, 0, 0);" class="" id="svg_7" fill-opacity="1"/><polyline fill="none" stroke="#222222" stroke-width="8" stroke-linejoin="round" stroke-dashoffset="" fill-rule="nonzero" marker-start="" marker-mid="" marker-end="" id="svg_8" points="393.6199165139778,203.02763679760372 394.1724027192891,203.02763679760372 394.72488892460046,203.02763679760372 395.2773751299118,203.02763679760372 397.48731995115713,203.02763679760372 400.2497509777138,203.02763679760372 403.5646682095818,203.02763679760372 406.8795854414498,203.02763679760372 409.6420164680065,203.02763679760372 412.40444749456316,203.02763679760372 414.6143923158085,204.13260920822637 416.8243371370539,204.6850954135377 420.1392543689218,205.7900678241604 421.7967129848558,206.3425540294717 424.55914401141246,207.44752644009438 427.3215750379691,208.55249885071706 429.5315198592145,209.10498505602837 431.1889784751485,209.6574712613397 432.84643709108246,210.20995746665105 434.5038957070165,210.7624436719624 437.2663267335732,211.86741608258504 438.92378534950717,212.41990228789638 440.58124396544116,212.41990228789638 442.23870258137515,212.97238849320772 443.89616119730914,213.52487469851906 445.5536198132432,213.52487469851906 446.6585922238658,214.0773609038304 448.31605083979986,214.0773609038304 449.4210232504225,214.62984710914174 450.52599566104516,215.18233331445307 452.18345427697915,215.18233331445307 453.2884266876018,215.73481951976441 453.8409128929132,215.73481951976441 454.9458853035358,215.73481951976441 455.4983715088472,216.28730572507575 456.60334391946986,216.28730572507575 457.1558301247812,216.28730572507575 458.2608025354038,216.28730572507575 458.8132887407152,216.28730572507575 459.9182611513379,216.28730572507575 460.47074735664916,216.28730572507575 461.0232335619606,216.28730572507575 461.57571976727183,216.28730572507575 462.12820597258326,216.28730572507575 462.6806921778945,216.28730572507575 463.2331783832058,216.28730572507575 463.7856645885172,216.28730572507575 464.8906369991399,215.73481951976441 465.4431232044512,215.73481951976441 466.54809561507386,215.73481951976441 467.65306802569654,215.73481951976441 468.20555423100785,215.18233331445307 469.31052664163053,215.18233331445307 470.4154990522532,215.18233331445307 470.9679852575645,214.62984710914174 472.0729576681872,214.62984710914174 473.1779300788099,214.62984710914174 473.7304162841212,214.62984710914174 474.83538869474387,214.0773609038304 475.3878749000552,214.0773609038304 475.94036110536655,214.0773609038304 475.94036110536655,214.0773609038304 476.49284731067786,214.0773609038304 476.49284731067786,214.0773609038304 477.04533351598917,213.52487469851906 477.04533351598917,213.52487469851906 " style="color: rgb(0, 0, 0);" class="" filter=""/>
    </g>
    <defs>
      <filter id="f001" inkscape:label="Matte jelly" x="0" y="0" width="1" height="1" inkscape:menu="ABCs" inkscape:menu-tooltip="Bulging, matte jelly covering" color-interpolation-filters="sRGB">
        <feColorMatrix values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.85 0" result="result0" in="SourceGraphic"/>
        <feGaussianBlur in="SourceAlpha" stdDeviation="7"/>
        <feSpecularLighting surfaceScale="5" specularConstant=".9" specularExponent="25">
          <feDistantLight elevation="60" azimuth="225"/>
        </feSpecularLighting>
        <feComposite operator="atop" in2="result0"/>
      </filter>
    </defs>
  </svg>
</div>
-->
<style>
html, body { margin:0; padding:0; overflow:hidden; }
svg { position:fixed; top:0; left:0; height:100%; width:100%; }
.txt { position:relative; top:20px; float:center; font-size:20px; fill:blue; }
text.winning { fill:green; }
text.losing { fill:red; }
</style>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-force.v1.min.js"></script>
<div>
	<svg id="gravity"></svg>
</div>
<script>

var nodes = [{radius:200, x:400, y:1, id:'First'}];
var simulation = d3.forceSimulation(nodes)
var y = d3.forceY(600);
var game = (function () {
	var g = {};
	g.level = 0;
	g.record = '';
	g.goals = ['D','L','R','DD','DL','DR','DDD','DDL','DDR','DLD','DLR','DRD','DRL','LDR','LDD','LRD','LRL','RDD','RDL','RLD','RLR'];
	g.goal = g.goals[g.level];
	g.bounce = function (wall) {
		g.record = g.record + wall;
	}
	g.clear = function () {
		g.record = '';
	}
	g.success = function () {
		if (g.record.length < g.goal.length) { return 'unknown'; }
		return g.record.substring(0,g.goal.length) == g.goal ? 'winning' : 'losing';
	}
	g.advance = function () {
		if (g.success() == 'winning') {
			g.level = g.level + 1;
			if (g.level >= g.goals.length) { g.level = 0; }
			g.record = '';
			g.goal = g.goals[g.level];
		}
	}
	g.format = function (str) {
		var o = '';
		for (c in str) {
			if (str[c] == 'D') { o = o + 'Down '; }
			if (str[c] == 'L') { o = o + 'Doo '; }
			if (str[c] == 'R') { o = o + 'Be '; }
		}
		return o;
	}
	return g;
}
)();

var svg = d3.select("#gravity");

function gravity(alpha) {
  var ymax = svg.node().scrollHeight - 150;
  var xmax = svg.node().scrollWidth - 150;
  for (var i = 0, n = nodes.length, node, k = alpha * 0.1; i < n; ++i) {
    node = nodes[i];
    if (node.y > ymax && (node.vy >= 0)) {
    	if (node.vy < 4) {
    		node.vy = 0;
    	}
    	else {
	    	node.vy = 0.9*(-node.vy);
	    	game.bounce('D');
	    }
    }
    else {
		node.vy += 400*k;
    }
    if (node.x > xmax && node.vx > 0) {
		node.vx = 0.9*(-node.vx);
		game.bounce('R');
    }
    else if (node.x < 150 && node.vx < 0) {
		node.vx = 0.9*(-node.vx);
		game.bounce('L');
    }
    else if (node.vy == 0) {
    	node.vx = 0.97*node.vx;
    }
  }
}

simulation.force("gravity", gravity);
simulation.velocityDecay(0.01);
simulation.alphaTarget(0.1);

var goal = svg.append("text")
	.attr("x", 20)
	.attr("y", 20)
	.attr("id", "goal")
	.attr("class", "txt")
	.text("");

var record = svg.append("text")
	.attr("x", 20)
	.attr("y", 60)
	.attr("id", "record")
	.attr("class", "txt")
	.text("");

svg.selectAll("circle")
	.data(nodes)
	.enter().append("svg:circle")
		.attr("r", function(d) { return d.radius - 2; })
		.style("fill", function(d, i) { return d3.rgb(50,50,255)})
		.call(d3.drag()
        	.on("start",dragstarted)
        	.on("drag",dragged)
        	.on("end",dragended));

function dragstarted(d) { 
	simulation.restart();
	simulation.velocityDecay(0.01);
	d.sx = 0;
	d.sy = 0;
    d.fx = d.x;
    d.fy = d.y;
    game.advance();
}

function dragged(d) {
	d.sx = d3.event.x - d.fx;
	d.sy = d3.event.y - d.fy;
    d.fx = d3.event.x;
    d.fy = d3.event.y;
    game.clear();
}

function dragended(d) {
    d.vx = d.sx;
    d.vy = d.sy;
    d.fx = null;
    d.fy = null;
    simulation.alphaTarget(0.1);
}

simulation.on("tick", function(e) {
	svg.selectAll("circle")
		.attr("cx", function(d) { return d.x; })
		.attr("cy", function(d) { return d.y; });
	goal.text(game.level + ': ' + game.format(game.goal));
	record.text(game.format(game.record)).attr("class",game.success());
});

</script>